{% extends "base.html" %}

{% block content %}
    <div class="row">
        <div class="col">
            <div class="text-center">
                    <h2>Категории расходов</h2>
            </div>
        </div>
    </div>
    <br>
    <table class="table table-bordered">
        <thead class="thead-light">
            <tr>
                <th scope="col" style="width: 5%">#</th>
                <th scope="col" style="width: 75%">Название</th>
                <th scope="col" style="width: 20%"></th>
            </tr>
        </thead>
        <tbody>
            {% for category in categories_list %}
                <tr>
                    <th class = "align-middle" scope="row">{{ loop.index }}</th>
                    <td class = "align-middle">
                        <span id="caption{{ loop.index }}">{{category }}</span>
                    <td class = "align-middle">
                        <div class="btn-group" role="group" aria-label="Basic example" style="width: 20">
                                <button type="button" class="btn btn-secondary" id="left_btn{{ loop.index }}" onclick="change_category({{ loop.index }})">Изменить</button>
                                <button type="button" class="btn btn-secondary" id="right_btn{{ loop.index }}">Удалить</button>
                            </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
            function change_category(num) {
              var xhr = new XMLHttpRequest();
        
              xhr.open('GET', '/category/changebtn', false);
              xhr.send();
        
              if (xhr.status != 200) {
                // обработать ошибку
                alert('Ошибка ' + xhr.status + ': ' + xhr.statusText);
              } else {
                var btnLeft = document.getElementById("left_btn" + num);
                var btnRight = document.getElementById("right_btn" + num);
                if (btnLeft.innerHTML == "Изменить") {
                    var caption = document.getElementById("caption" + num)
                    var text_input = document.createElement("input");
                    text_input.type = "text"
                    text_input.id = "input" + num
                    text_input.style = "width: 100%"
                    text_input.value = caption.innerHTML;
                    caption.parentNode.replaceChild(text_input, caption);
                    btnLeft.innerHTML = "Сохранить"
                    btnRight.innerHTML = "Отмена"
                } else {
                    var text_input = document.getElementById('input' + num)
                    var caption = document.createElement("span");
                    caption.id = "caption" + num
                    caption.innerHTML = text_input.value;
                    text_input.parentNode.replaceChild(caption, text_input);
                    btnLeft.innerHTML = "Изменить"
                    btnRight.innerHTML = "Удалить"
                }
                
              }
            }
    </script>
{% endblock %}
